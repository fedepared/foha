<mat-card class="titulo">
    <mat-card-header>
        <mat-card-title style="line-height:60px;">Transformadores</mat-card-title>
    </mat-card-header>
    <br>
  </mat-card>
  <div>

  <!-- Buscador -->
    <div style="padding-top:30px">
        
        <form [formGroup]="form" class="search__form">
          <div></div>
          <fieldset>
            <legend>OT</legend>
            <mat-form-field class="search__form_field" appearance="outline">
              <mat-label>Desde</mat-label>
              <input type="number"
                    matInput
                    formControlName="oTeDesde"
                    
                    (keydown.enter)="function($event)"
              >
            </mat-form-field>
            <mat-form-field class="search__form_field" appearance="outline">
              <mat-label>Hasta</mat-label>
              <input type="number"
                    matInput
                    formControlName="oTeHasta"
                    
                    (keydown.enter)="function($event)"
              >
            </mat-form-field>
          </fieldset>
          <fieldset>
            <legend>OP</legend>
            <mat-form-field class="search__form_field" appearance="outline">
              <mat-label>Desde</mat-label>
              <input type="number"
              
              (keydown.enter)="function($event)"
                    matInput
                    formControlName="oPeDesde"
                    
              >
            </mat-form-field>
            <mat-form-field class="search__form_field" appearance="outline">
              <mat-label>Hasta</mat-label>
              <input type="number"
              
              (keydown.enter)="function($event)"
                    matInput
                    formControlName="oPeHasta"
                    
              >
            </mat-form-field>
          </fieldset>
          <fieldset>
            <legend>Rango</legend>
            <mat-form-field class="search__form_field" appearance="outline">
              <mat-label>Desde</mat-label>
              <input type="number"
              
              (keydown.enter)="function($event)"
                    matInput
                    formControlName="rangoInicioDesde"
                    
              >
            </mat-form-field>
            <mat-form-field class="search__form_field" appearance="outline">
              <mat-label>Hasta</mat-label>
              <input type="number"
              
              (keydown.enter)="function($event)"
                    matInput
                    formControlName="rangoInicioHasta"
                    
              >
            </mat-form-field>
          </fieldset>
          <fieldset>
            <legend>Potencia</legend>
            <mat-form-field class="search__form_field" appearance="outline">
              <mat-label>Desde</mat-label>
              <input type="number"
              
              (keydown.enter)="function($event)"
                    matInput
                    formControlName="potenciaDesde"
                    
              >
            </mat-form-field>
  
            <mat-form-field class="search__form_field" appearance="outline">
              <mat-label>Hasta</mat-label>
              <input type="number"
              
              (keydown.enter)="function($event)"
                    matInput
                    formControlName="potenciaHasta"
                    
              >
            </mat-form-field>
          </fieldset>
          <fieldset>
            <legend>Nucleos</legend>
            <mat-form-field class="search__form_field" appearance="outline">
              <mat-label>Nucleos</mat-label>
              <input type="text"
              
              (keydown.enter)="function($event)"
                    matInput
                    formControlName="nucleos"
                    
              >
            </mat-form-field>
          </fieldset>
          <fieldset>
            <legend>Serie</legend>
            <mat-form-field class="search__form_field" appearance="outline">
              <mat-label>Serie</mat-label>
              <input type="text"
              
              (keydown.enter)="function($event)"
                    matInput
                    formControlName="serie"
              >
            </mat-form-field>
          </fieldset>
          <fieldset>
            <legend>Cliente</legend>
            <mat-form-field class="search__form_field-especial" appearance="outline">
              <mat-label>Cliente</mat-label>
              <input type="text"
              
              (keydown.enter)="function($event)"
                    matInput
                    formControlName="nombreCli"
                  
              >
            </mat-form-field>  
          </fieldset>
          <fieldset>
            <legend>Obs.</legend>
            <mat-form-field class="search__form_field-especial" appearance="outline">
              <mat-label>Observaciones</mat-label>
              <input type="text"
              
              (keydown.enter)="function($event)"
                    matInput
                    formControlName="observaciones"
                  
              >
            </mat-form-field>  
          </fieldset>
          
          <fieldset>
            <legend>Vendedor</legend>
            <mat-form-field class="search__form_field-especial" appearance="outline">
              <mat-label>Vendedor</mat-label>
              <mat-select formControlName="vendedor">
                <mat-option [value]="null"> </mat-option>
                <mat-option *ngFor="let vendedor of vendedores" [value]="vendedor.idVendedor">
                  {{vendedor.nombre}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </fieldset>
          <fieldset>
            <legend>Mes</legend>
            <mat-form-field appearance="outline" class="search__form_field-especial"> 
              <mat-label>Elija el mes</mat-label>
                <mat-select [compareWith]="compareObjects" formControlName="month" multiple>
                  <mat-option *ngFor="let m of months"  [value]="m">
                    {{m.mes}} de {{m.anio}}
                  </mat-option>
                  <!-- <mat-option #allSelected (click)="toggleAllSelection()"></mat-option> -->
                </mat-select>
            </mat-form-field>
          </fieldset>
          <fieldset>
            <legend>Tipo</legend>
            <mat-form-field class="search__form_field-especial" appearance="outline">
            <mat-label>Tipo Transformador</mat-label>
              <mat-select formControlName="tTransfo">
                <mat-option [value]="null"> </mat-option>
                <mat-option *ngFor="let t of tipoTransfo" [value]="t.idTipoTransfo">
                  {{t.nombreTipoTransfo}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </fieldset>
          <fieldset>
            <legend>limpiar / buscar</legend>
            <button  mat-icon-button (click)="clean()" color="primary" aria-label="Example icon button with a delete icon">
              <mat-icon>backspace</mat-icon>
            </button>
            <button  mat-icon-button (click)="applyApiFilter()" color="primary" aria-label="Example icon button with a delete icon">
              <mat-icon>search</mat-icon>
            </button>
          </fieldset>
        </form>
    
    </div>
    <div class="example-loading-shade"
    *ngIf="isLoadingResults">
      <mat-spinner *ngIf="isLoadingResults" style="margin:0 auto;"></mat-spinner>
    </div>
    <!-- <div *ngIf="!isLoadingResults" infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="40" (scrolled)="onScroll()"  
    [scrollWindow]="false" style="height: 600px; overflow-y: scroll;"> -->
    <div *ngIf="!isLoadingResults" class="example-container mat-elevation-z8">
    

      <!--Menu nuevo-->
      <div id="circularMenu" class="circular-menu" style="z-index:5000;">

        
          <button mat-mini-fab class="floating-btn"  onclick="document.getElementById('circularMenu').classList.toggle('active');">
            <mat-icon>menu</mat-icon>
          </button>
      
        <menu class="items-wrapper">
          <a class="menu-item" *ngIf="idTipoUs!='4'">
            <button style="background-color:teal;" mat-mini-fab color="primary" (click)="dialogAddTransfo()" >
              <mat-icon>add</mat-icon>
            </button>
          </a>
          <a class="menu-item">
            <button style="background-color:teal;" mat-mini-fab color="primary" (click)="export()">
              <mat-icon><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
                width="24" height="24"
                viewBox="0 0 172 172"
                style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><g fill="#ffffff"><path d="M86,21.5l-71.66667,14.33333v100.33333l71.66667,14.33333zM100.33333,35.83333v14.33333h14.33333v14.33333h-14.33333v14.33333h14.33333v14.33333h-14.33333v14.33333h14.33333v14.33333h-14.33333v14.33333h50.16667c3.956,0 7.16667,-3.21067 7.16667,-7.16667v-86c0,-3.956 -3.21067,-7.16667 -7.16667,-7.16667zM129,50.16667h14.33333v14.33333h-14.33333zM29.92643,59.46094h12.73763l6.62077,15.87305c0.5375,1.29717 0.94208,2.80149 1.35775,4.50716h0.18197c0.2365,-1.02483 0.7179,-2.59064 1.44173,-4.63314l7.37663,-15.74707h11.61784l-13.87142,26.30111l14.27734,26.77702h-12.3877l-7.97852,-17.30078c-0.301,-0.60917 -0.65799,-1.83567 -0.95182,-3.54134h-0.11198c-0.17917,0.817 -0.5403,2.04015 -1.0778,3.68132l-8.0485,17.16081h-12.44368l14.76725,-26.56706zM129,78.83333h14.33333v14.33333h-14.33333zM129,107.5h14.33333v14.33333h-14.33333z"></path></g></g></svg></mat-icon>
            </button>
          </a>
          <a class="menu-item">
            <button style="background-color:teal;" mat-mini-fab color="primary" (click)="exportTimes()">
              <mat-icon>hourglass_top</mat-icon>
            </button>
          </a>
          <a class="menu-item" *ngIf="idTipoUs!='4'">
            <button style="background-color:teal;" mat-mini-fab color="primary" (click)="showOrHide()">
              <mat-icon *ngIf="!selectColumn">visibility</mat-icon>
              <mat-icon *ngIf="selectColumn">visibility_off</mat-icon>
            </button>
          </a>
          <a class="menu-item" *ngIf="selectColumn && selection.selected.length>0">
            <button style="background-color:teal;" *ngIf="selectColumn && selection.selected.length>0" mat-mini-fab color="primary" (click)="dialogEditAllTransfo()">
              <mat-icon>mode</mat-icon>
            </button>
            <!-- <br *ngIf="selectColumn && selection.selected.length>0"> -->
          </a>
          <a class="menu-item" *ngIf="selectColumn && selection.selected.length>0">
            <button style="background-color:teal;" *ngIf="selectColumn && selection.selected.length>0" mat-mini-fab color="primary" (click)="dialogDeleteAllTransfo()">
              <mat-icon>delete</mat-icon>
            </button>
          </a>
          <a class="menu-item" *ngIf="idTipoUs!='4'">
            <button style="background-color:teal;" mat-mini-fab (click)="openCheckOT()">
              <mat-icon>rule</mat-icon>
            </button>
          </a>
        </menu>
      
      </div>
  
  
      <!--Tabla transformadores-->
  <table mat-table [dataSource]="dataGetTrafos" id="tabla">
  
    <ng-container matColumnDef="select" style="padding-right:5px;" sticky="true" >
      <th mat-header-cell *matHeaderCellDef style="min-width:40px!important"><mat-icon>checkbox</mat-icon>
      </th>
      <td mat-cell *matCellDef="let row">
        <mat-checkbox #c *ngIf="selectColumn" [checked]="selection.isSelected(row)" (change)="$event ? selection.toggle(row) : null">
        </mat-checkbox>
        <mat-icon style="color:gray;" *ngIf="!selectColumn">
          visibility_off
        </mat-icon>
      </td>
    </ng-container>
      <ng-container matColumnDef="Accion" id="Accion" sticky>
          <th mat-header-cell *matHeaderCellDef style="border-bottom-color: black!important;border-bottom-width:2.5px!important;" > Accion </th>
          <td mat-cell *matCellDef="let row" > 
          <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button *ngIf="idTipoUs!='4'" mat-icon-button class="editBorr" color="primary"  (click)="dialogEditTransfo(row)">
              <mat-icon>edit</mat-icon>
            </button>   
             <button mat-icon-button style="color:teal;" class="editBorr" (click)="onRowClicked(row.idTransfo)" matTooltip="Procesos">
              <mat-icon>av_timer</mat-icon>
            </button>
            <button *ngIf="idTipoUs!='4'" mat-icon-button color="warn" class="editBorr" (click)="dialogDeleteTransfo(row)" >
              <mat-icon>delete</mat-icon>
            </button>
          </mat-menu>
          </td>
      </ng-container>
      <ng-container  *ngFor="let column of displayedColumns2" matColumnDef="{{column}}" sticky="true" > 
          <th mat-header-cell *matHeaderCellDef style="text-align:center;border-bottom-color: black!important;border-bottom-width:2.5px!important;"  matTooltip={{tooltipTrafo(column)}} matTooltipPosition="above">
            {{encabezadosTrafo(column)}}
          </th>
          <td mat-cell *matCellDef="let element" style="text-align:center;" [ngClass]="(column=='fechaProd')? colorFOT(element):''"  [matTooltip]="(column=='nombreCli' || column=='observaciones') ? element[column] : column=='idVendedorNavigation' ? ((element[column]==null ? '' : element[column].nombre)):''"> {{column=='fechaPactada'|| column=='fechaProd' ? (element[column] | date:'dd/MM/yy') :  column=='nombreCli' ? breakCli(element[column]) : column=='observaciones' ? breakObs(element[column]): column=='idVendedorNavigation' ? (element[column]==null ? '' : element[column].abrev) : column=='oPe' ? op(element[column]) :element[column]}} </td>
      </ng-container>
    
      <ng-container *ngFor="let column of etapasColumns;let i=index" matColumnDef="{{column}}">
        <th mat-header-cell *matHeaderCellDef [style.border-left]="(column=='BT1' || column=='AT1' || column=='RG1' || column=='RF1' || column=='ENS' ) ? '2px solid rgba(56,56,56,0.60)' :((column=='DOC') ? '2.5px solid rgb(56,56,56)' : '0')" style="padding:0px 10px!important;text-align:center;border-bottom-width:1.5px;border-bottom-color: rgba(0,0,0,0.5)!important;" matTooltip={{toolTipEtapas(column)}} matTooltipPosition="above">
            {{column}}
        </th>
        <td mat-cell *matCellDef="let element">
          <etapa-column-component3 [etapa]="getEtapa(element, column,i)" (actualizado)="actualizar($event)">
            
          </etapa-column-component3>
        </td>
      </ng-container>
    
      <tr mat-header-row *matHeaderRowDef="allColumns;sticky: true" ></tr>
      <tr mat-row *matRowDef="let row; columns: allColumns;"></tr>
  
      <ng-container matColumnDef="groupHeader">
          <td mat-cell *matCellDef="let row" colspan="999" style="width:100%;background-color:rgb(247,150,70)!important;text-align:left"><div class="grupo" style="margin-left:15px;"><strong>{{row.group}}</strong></div></td>
      </ng-container>
      
      <tr mat-row *matRowDef="let row; columns: ['groupHeader']; when: isGroup"></tr>
    </table>
  </div>
  <mat-paginator style="display:flex;" [pageSizeOptions]="[100,200,350,550]" showFirstLastButtons></mat-paginator>
  <!-- </div> -->
  
</div>